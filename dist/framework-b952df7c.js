import{R as e,r as t}from"./vendor-2388be36.js";const n=t.memo,a=t.useCallback,r=t.useState,c=t.useRef,o=t.useReducer,i=t.useEffect,s=t.useMemo;function l(e){return null==e?[]:Array.isArray(e)?e:[e]}function d(){}function u(e,t=!0){null!=e&&setTimeout((()=>e.scrollIntoView({behavior:t?"smooth":"auto",block:"nearest"})),100)}const m=n((function(t){const{id:n,onClick:a,className:r,record:c,children:o}=t;return e.createElement("li",{role:"option",id:n,className:"x-cc-ll "+r,onClick:()=>a(c)},o)}));function p(t){const{id:n,data:a,keyboard:r,itemRenderer:c,onSelect:s,onKeyFocus:p=d}=t,y=l(t.selection),b=a.length,x=n+"-option-",f=a.indexOf(y[0]),g=-1===f?"":x+f,h=r?r.key:"",k=c,[v,w]=o((function(e,t){let n=e;switch(t){case"ArrowUp":n=-1===e?b-1:e-1;break;case"ArrowDown":n=-1===e?0:e+1}return n===e?e:0===b?-1:(b+n)%b}),f);return"Enter"===h&&-1!==v&&s(a[v]),i((()=>{h&&"Enter"!==h&&w(h)}),[r,h]),i((()=>{""!==g&&u(document.getElementById(g),!1)}),[f]),i((()=>{-1!==v&&(p(x+v),u(document.getElementById(x+v),!1))}),[v]),e.createElement("ul",null,a.map(((t,n)=>{const a=x+n,r=-1!==y.indexOf(t),c=(v===n?"focus x-cc-oo":"")+(r?" selected x-cc-nn":"");return e.createElement(m,{key:a,id:a,className:c,record:t,selected:r,onClick:s},e.createElement(k,{record:t,selected:r}))})))}var y=n((function(t){const{id:n,className:r="",style:c,expanded:o,data:i,keyboard:s,itemRenderer:d,onSelect:u,selection:m,onKeyFocus:y}=t,b=a((e=>u(e)),[u]);return e.createElement("div",{id:n,role:"listbox",className:"x-cc-kk "+r,style:c,tabIndex:-1},!0===o?e.createElement(p,{id:n,data:l(i),keyboard:s,itemRenderer:d,onSelect:b,onKeyFocus:y,selection:m}):null)}));const b=window,x=b.addEventListener,f=b.removeEventListener,g={};function h(e){if(null==e)return g;const t=b.innerHeight,{top:n,bottom:a,height:r}=e.getBoundingClientRect();if(n<0||n>t)return g;return n<t-a?{top:r,maxHeight:t-a-5}:{bottom:r,maxHeight:n-5}}const k=Object.assign;function v(e,t){return k({},e,t)}const w={id:"",expanded:!1,waiting:!1,selection:[],data:[],range:[],keyboard:{key:"",count:0},activeDescendant:""};function E(e,t){switch(t.type){case 0:return v(e,{expanded:!1,activeDescendant:""});case 1:return v(e,{expanded:!0});case 2:return E(e,{type:e.expanded?0:1});case 3:return v(e,{expanded:!0,keyboard:(n=e.keyboard,a=t.key,{key:a,count:n.key===a?n.count+1:0})});case 4:return v(e,{expanded:!1,activeDescendant:"",range:e.data,selection:t.selection});case 6:{const n=new RegExp(t.query,"i");return v(e,{expanded:!0,range:e.data.filter((e=>n.test(e.toString())))})}case 5:return v(e,{expanded:t.expand,waiting:!1,data:t.data,range:t.data});case 7:return v(e,{waiting:t.waiting});case 8:return v(e,{activeDescendant:t.id})}var n,a;return e}const{round:D,random:N}=Math;function R(e=""){return e+D(N()+1e17*N()).toString(32)}var S=n((function(t){const l=c(null),u=c(null),{queryMode:m="local",displayField:p="text",className:k="",forceSelection:D=!0,data:N,hideTrigger:S,disabled:A,readOnly:C,placeholder:F,onChange:K=d,onRemoteQuery:I=d,optionRenderer:O,displayRenderer:T}=t,j=s((()=>null==O?(t=>n((function(n){return e.createElement("div",{className:"x-cc-mm"},n.record[t])})))(p):O),[p,O]),[q,L]=o(E,w,(e=>v(e,{id:R("combobox-"),displayField:p}))),{toggle:B,select:H,handleKeys:M,handleLocalSearch:z,setData:U,setWaiting:W,setActiveDecendent:P}=function(e){const t=[e],n=a((()=>e({type:1})),t),r=a((()=>e({type:0})),t),c=a((()=>e({type:2})),t),o=a((t=>e({type:4,selection:t})),t),i=a((t=>e({type:6,query:t})),t),s=a(((t,n=!1)=>{e({type:5,data:t,expand:n})}),t),l=a((t=>e({type:7,waiting:t})),t),d=a((t=>e({type:8,id:t})),t),u=a((function(t){switch(t.key){case"ArrowDown":case"ArrowUp":case"Enter":e({type:3,key:t.key});break;case"Escape":r()}}),t);return{expand:n,collapse:r,toggle:c,select:o,handleKeys:u,handleLocalSearch:i,setData:s,setWaiting:l,setActiveDecendent:d}}(L),{id:Q,expanded:V,selection:G,range:J,waiting:X,keyboard:Y,activeDescendant:Z}=q,$=function(e,t){const n=e.current,[a,c]=r((()=>h(n)));return i((()=>{let e=!1;function a(){t&&!e&&(e=!0,b.requestAnimationFrame((()=>{c(h(n)),e=!1})))}return x("resize",a),x("scroll",a),t?a():c(g),()=>{f("resize",a),f("scroll",a)}}),[t,n]),a}(l,V),_=Q+"-picker",ee=a((()=>{!function(e){let t=e.current;t&&t.focus()}(u),B()}),[u]),te=a(function(e,t=250,n){let a;return function(){function r(t){clearTimeout(a),e.apply(n,t)}clearTimeout(a),a=setTimeout(r,t,Array.prototype.slice.call(arguments))}}((e=>{const t=e.target.value;"local"===m?z(t):(W(!0),Promise.resolve(I(t)).then((e=>{e&&U(e,!0)})))})),[m,I,W,z]);i((()=>{void 0!==N&&U(N)}),[N]),i((()=>{K(G)}),[G,K]);const ne="x-bb-ee "+k+(X?" wating x-bb-jj":"");return e.createElement("div",{className:ne,ref:l},e.createElement("div",{className:"x-bb-ff",role:"combobox","aria-expanded":V?"true":"false","aria-owns":_,"aria-haspopup":"listbox"},e.createElement("input",{type:"text","aria-autocomplete":"both","aria-controls":_,"aria-activedescendant":Z,onKeyDown:M,onInput:te,className:"x-bb-gg",ref:u,disabled:A,readOnly:C,placeholder:F}),S?null:e.createElement("div",{className:"x-bb-hh",tabIndex:-1,role:"button","aria-label":"Show options",onClick:A?void 0:ee},"â–¼")),e.createElement(y,{id:_,data:J,itemRenderer:j,expanded:V,onSelect:H,selection:G,className:"x-bb-ii",style:$,keyboard:Y,onKeyFocus:P}))}));export{S as C,i as a,a as b,n as m,r as u};
//# sourceMappingURL=framework-b952df7c.js.map
