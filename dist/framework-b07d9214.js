import{R as e,r as t}from"./vendor-2388be36.js";const n=t.memo,a=t.useCallback,r=t.useState,o=t.useRef,c=t.useReducer,i=t.useEffect,l=t.useMemo;function s(e){return null==e?[]:Array.isArray(e)?e:[e]}function d(e,t=!0){null!=e&&setTimeout((()=>e.scrollIntoView({behavior:t?"smooth":"auto",block:"nearest"})),100)}const u=n((function(t){const{id:n,onClick:a,className:r,record:o,children:c}=t;return e.createElement("li",{role:"option",id:n,className:"x-cc-ll "+r,onClick:()=>a(o)},c)}));function p(t){const{id:n,data:a,keyboard:r,itemRenderer:o,onSelect:l}=t,p=s(t.selection),m=a.length,y=n+"-option-",b=a.indexOf(p[0]),f=-1===b?"":y+b,x=o,[g,h]=c((function(e,t){let n=e;switch(t.key){case"ArrowUp":n=-1===e?m-1:e-1;break;case"ArrowDown":n=-1===e?0:e+1}return n===e?e:0===m?-1:(m+n)%m}),b);return i((()=>{r&&r.key&&h(r)}),[r]),i((()=>{""!==f&&d(document.getElementById(f),!1)}),[b]),i((()=>{-1!==g&&d(document.getElementById(y+g),!1)}),[g]),e.createElement("ul",null,a.map(((t,n)=>{const a=y+n,r=-1!==p.indexOf(t),o=(g===n?"focus x-cc-oo":"")+(r?" selected x-cc-nn":"");return e.createElement(u,{key:a,id:a,className:o,record:t,selected:r,onClick:l},e.createElement(x,{record:t,selected:r}))})))}var m=n((function(t){const{id:n,className:r="",style:o,expanded:c,data:i,keyboard:l,itemRenderer:d,onSelect:u,selection:m}=t,y=a((e=>u(e)),[u]);return e.createElement("div",{id:n,role:"listbox",className:"x-cc-kk "+r,style:o,tabIndex:-1},!0===c?e.createElement(p,{id:n,data:s(i),keyboard:l,itemRenderer:d,onSelect:y,selection:m}):null)}));const y=window,b=y.addEventListener,f=y.removeEventListener,x={display:"none"};function g(e){if(null==e)return x;const t=y.innerHeight,{top:n,bottom:a,height:r}=e.getBoundingClientRect();if(n<0||n>t)return x;return n<t-a?{top:r,maxHeight:t-a-5}:{bottom:r,maxHeight:n-5}}const h=Object.assign;function k(e,t){return h({},e,t)}const w={id:"",expanded:!1,waiting:!1,selection:[],data:[],range:[],keyboard:{key:"",count:0}};function E(e,t){switch(t.type){case 0:return k(e,{expanded:!1,focusIndex:-1});case 1:return k(e,{expanded:!0});case 2:return E(e,{type:e.expanded?0:1});case 3:return k(e,{expanded:!0,keyboard:(n=e.keyboard,a=t.key,{key:a,count:n.key===a?n.count+1:0})});case 4:return k(e,{expanded:!1,focusIndex:-1,range:e.data,selection:t.selection});case 6:{const n=new RegExp(t.query,"i");return k(e,{expanded:!0,range:e.data.filter((e=>n.test(e.toString())))})}case 5:return k(e,{expanded:t.expand,waiting:!1,data:t.data,range:t.data});case 7:return k(e,{waiting:t.waiting})}var n,a;return e}const{round:v,random:N}=Math;function R(e=""){return e+v(N()+1e17*N()).toString(32)}var S=n((function(t){const s=o(null),d=o(null),{queryMode:u="local",displayField:p="text",className:h="",forceSelection:v=!0,data:N,hideTrigger:S,disabled:A,readOnly:C,placeholder:I,onChange:D,onRemoteQuery:O,optionRenderer:T,displayRenderer:j}=t,q=l((()=>null==T?(t=>n((function(n){return e.createElement("div",{className:"x-cc-mm"},n.record[t])})))(p):T),[p,T]),[L,B]=c(E,w,(e=>k(e,{id:R("combobox-"),displayField:p}))),{toggle:F,select:H,collapse:K,handleKeys:M,handleLocalSearch:z,setData:U,setWaiting:W}=function(e){const t=[e],n=a((()=>e({type:1})),t),r=a((()=>e({type:0})),t),o=a((()=>e({type:2})),t),c=a((t=>e({type:4,selection:t})),t),i=a((function(t){switch(t.key){case"ArrowDown":case"ArrowUp":case"Enter":e({type:3,key:t.key});break;case"Escape":r()}}),t),l=a((t=>e({type:6,query:t})),t),s=a(((t,n=!1)=>{e({type:5,data:t,expand:n})}),t),d=a((t=>e({type:7,waiting:t})),t);return{expand:n,collapse:r,toggle:o,select:c,handleKeys:i,handleLocalSearch:l,setData:s,setWaiting:d}}(B),{id:P,expanded:Q,selection:V,range:G,waiting:J,keyboard:X}=L,Y=function(e,t){const n=e.current,[a,o]=r((()=>g(n)));return i((()=>{let e=!1;function a(){t&&!e&&(e=!0,y.requestAnimationFrame((()=>{o(g(n)),e=!1})))}return b("resize",a),b("scroll",a),t?a():o(x),()=>{f("resize",a),f("scroll",a)}}),[t,n]),a}(s,Q),Z=P+"-picker",$=a((()=>{!function(e){let t=e.current;t&&t.focus()}(d),F()}),[d]),_=a(function(e,t=250,n){let a;return function(){function r(t){clearTimeout(a),e.apply(n,t)}clearTimeout(a),a=setTimeout(r,t,Array.prototype.slice.call(arguments))}}((e=>{const t=e.target.value;"local"===u?z(t):(W(!0),Promise.resolve("function"==typeof O&&O(t)).then((e=>{!1!==e&&U(e,!0)})))})),[u,O,W,z]);i((()=>{void 0!==N&&U(N)}),[N]),i((()=>{"function"==typeof D&&D(V)}),[V,D]);const ee="x-bb-ee "+h+(J?" wating x-bb-jj":"");return e.createElement("div",{className:ee,ref:s},e.createElement("div",{className:"x-bb-ff",role:"combobox","aria-expanded":Q?"true":"false","aria-owns":Z,"aria-haspopup":"listbox"},e.createElement("input",{type:"text","aria-autocomplete":"both","aria-controls":Z,"aria-activedescendant":"",onKeyDown:M,onInput:_,className:"x-bb-gg",ref:d,disabled:A,readOnly:C,placeholder:I}),S?null:e.createElement("div",{className:"x-bb-hh",tabIndex:-1,role:"button","aria-label":"Show options",onClick:A?void 0:$},"â–¼")),e.createElement(m,{id:Z,data:G,itemRenderer:q,expanded:Q,onSelect:H,selection:V,className:"x-bb-ii",style:Y,keyboard:X}))}));export{S as C,i as a,a as b,n as m,r as u};
//# sourceMappingURL=framework-b07d9214.js.map
